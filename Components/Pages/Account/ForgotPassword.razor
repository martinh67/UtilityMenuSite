@page "/account/forgot-password"
@rendermode InteractiveServer
@layout AuthLayout
@using Microsoft.AspNetCore.Identity
@inject UserManager<Data.Models.ApplicationUser> UserManager

<PageTitle>Forgot Password â€” UtilityMenu</PageTitle>

<h4 class="fw-bold mb-1">Reset your password</h4>
<p class="text-muted small mb-4">Enter your email and we'll send a reset link.</p>

@if (_sent)
{
    <AlertBanner Message="If an account exists for that email, a password reset link has been sent." Type="success" Dismissible="false" />
    <div class="text-center mt-3">
        <a href="/account/login" class="btn btn-outline-primary">Back to Sign In</a>
    </div>
}
else
{
    <EditForm Model="_model" OnValidSubmit="HandleSubmit">
        <DataAnnotationsValidator />
        <div class="mb-3">
            <label class="form-label small fw-semibold">Email Address</label>
            <InputText @bind-Value="_model.Email" type="email" class="form-control" placeholder="you@example.com" />
            <ValidationMessage For="() => _model.Email" class="text-danger small" />
        </div>
        <button type="submit" class="btn btn-primary w-100" disabled="@_submitting">
            @if (_submitting) { <span class="spinner-border spinner-border-sm me-2"></span> }
            Send Reset Link
        </button>
        <div class="text-center mt-3">
            <a href="/account/login" class="small text-decoration-none">Back to Sign In</a>
        </div>
    </EditForm>
}

@code {
    private readonly ForgotPasswordModel _model = new();
    private bool _sent;
    private bool _submitting;

    private async Task HandleSubmit()
    {
        _submitting = true;
        var user = await UserManager.FindByEmailAsync(_model.Email!);
        if (user is not null)
        {
            var token = await UserManager.GeneratePasswordResetTokenAsync(user);
            // TODO: Send email with reset link using EmailService
        }
        _sent = true;
        _submitting = false;
    }

    private class ForgotPasswordModel
    {
        [System.ComponentModel.DataAnnotations.Required, System.ComponentModel.DataAnnotations.EmailAddress]
        public string? Email { get; set; }
    }
}
